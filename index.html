<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kevin Matoka | Clinical Leader & Healthcare Technologist</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="assets/icons/favicon.ico">
    <!-- Add Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container nav-container">
            <a href="#home" class="logo">Kevin<span>Matoka</span></a>
            <button class="menu-toggle" id="menuToggle">
                <i class="fas fa-bars"></i>
            </button>
            <ul class="nav-menu" id="navMenu">
                <li><a href="#home">Home</a></li>
                <li><a href="#about">About</a></li>
                <li><a href="#skills">Expertise</a></li>
                <li><a href="#projects">Projects</a></li>
                <li><a href="#career">Career</a></li>
                <li><a href="#contact">Contact</a></li>
                <!-- Admin link REMOVED from public site -->
            </ul>
        </div>
    </nav>

    <!-- Hero Section -->
    <section id="home" class="hero">
        <div class="container hero-container">
            <div class="hero-content">
                <h3 class="hero-subtitle">Nursing Officer | Healthcare Technologist | Educator</h3>
                <h1 class="hero-title">Kevin Matoka Tiong'i</h1>
                <p class="hero-description">
                    Bridging clinical excellence with technical innovation to build safer, more efficient, 
                    and data-driven healthcare systems in Kenya and beyond.
                </p>
                <div class="hero-buttons">
                    <a href="#projects" class="btn btn-primary">View My Work</a>
                    <a href="#contact" class="btn btn-secondary">Contact Me</a>
                </div>
            </div>
            <div class="hero-image">
                <div class="image-placeholder">
                    <!-- Profile photo will be loaded dynamically -->
                    <i class="fas fa-user-md" id="profilePlaceholder"></i>
                    <p>Professional Photo</p>
                </div>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="section about">
        <div class="container">
            <h2 class="section-title">About Me</h2>
            <div class="about-content">
                <div class="about-text">
                    <p id="about-text-1">
                        I am a detail-oriented and results-driven Nursing Officer with over 2 years of progressive 
                        clinical and leadership experience across diverse healthcare settings. Currently serving as 
                        Head of Department, School of Nursing at Nakuru College of Health Science and Management.
                    </p>
                    <p id="about-text-2">
                        <strong>My unique value:</strong> I combine hands-on clinical expertise with technical skills 
                        in software engineering, database management, and cybersecurity. This dual competency allows me 
                        to translate clinical workflows into technical requirements, design secure health applications, 
                        and implement systems that improve patient care and healthcare delivery.
                    </p>
                    <p id="about-text-3">
                        Certified in Basic Life Support (BLS), Advanced Trauma Life Support (ATLS), Advanced 
                        Cardiovascular Life Support (ACLS), and Cybersecurity Essentials.
                    </p>
                    <div class="about-highlights">
                        <div class="highlight-item">
                            <i class="fas fa-graduation-cap"></i>
                            <span>BSc. Nursing, Kenya Methodist University</span>
                        </div>
                        <div class="highlight-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>Based in Nakuru, Kenya</span>
                        </div>
                        <div class="highlight-item">
                            <i class="fas fa-language"></i>
                            <span>Fluent: English & Swahili</span>
                        </div>
                    </div>
                </div>
                <div class="about-stats">
                    <div class="stat-card">
                        <h3 id="stat-years">2+</h3>
                        <p>Years Clinical Experience</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="stat-students">500+</h3>
                        <p>Students Mentored</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="stat-community">1000+</h3>
                        <p>Community Members Served</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="stat-satisfaction">98%</h3>
                        <p>Patient Satisfaction</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Skills & Expertise Section -->
    <section id="skills" class="section skills">
        <div class="container">
            <h2 class="section-title">Areas of Expertise</h2>
            <div class="skills-grid" id="skills-grid">
                <!-- Skills will be loaded dynamically from Supabase -->
                <div class="loading-skills">
                    <i class="fas fa-spinner fa-spin"></i> Loading skills...
                </div>
            </div>
        </div>
    </section>

    <!-- Projects Section -->
    <section id="projects" class="section projects">
        <div class="container">
            <h2 class="section-title">Projects & Impact</h2>
            <div class="projects-grid" id="projects-grid">
                <!-- Projects will be loaded dynamically from Supabase -->
                <div class="loading-projects">
                    <i class="fas fa-spinner fa-spin"></i> Loading projects...
                </div>
            </div>
        </div>
    </section>

    <!-- Career Timeline -->
    <section id="career" class="section career">
        <div class="container">
            <h2 class="section-title">Career Journey</h2>
            <div class="timeline" id="career-timeline">
                <!-- Career items will be loaded dynamically from Supabase -->
                <div class="loading-career">
                    <i class="fas fa-spinner fa-spin"></i> Loading career timeline...
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section id="contact" class="section contact">
        <div class="container">
            <h2 class="section-title">Get In Touch</h2>
            <div class="contact-content">
                <div class="contact-info">
                    <div class="contact-item">
                        <i class="fas fa-envelope"></i>
                        <div>
                            <h3>Email</h3>
                            <a href="mailto:matokakevin98@gmail.com" id="contact-email">matokakevin98@gmail.com</a>
                        </div>
                    </div>
                    <div class="contact-item">
                        <i class="fas fa-phone"></i>
                        <div>
                            <h3>Phone</h3>
                            <a href="tel:+254790969743" id="contact-phone">+254 790 969 743</a>
                        </div>
                    </div>
                    <div class="contact-item">
                        <i class="fas fa-map-marker-alt"></i>
                        <div>
                            <h3>Location</h3>
                            <p id="contact-location">Nakuru, Kenya</p>
                        </div>
                    </div>
                    <div class="contact-item">
                        <i class="fas fa-file-pdf"></i>
                        <div>
                            <h3>Download CV</h3>
                            <a href="#" class="download-link">Download PDF Version</a>
                        </div>
                    </div>
                </div>
                <div class="contact-form">
                    <form id="contactForm">
                        <div class="form-group">
                            <input type="text" placeholder="Your Name" required>
                        </div>
                        <div class="form-group">
                            <input type="email" placeholder="Your Email" required>
                        </div>
                        <div class="form-group">
                            <input type="text" placeholder="Subject" required>
                        </div>
                        <div class="form-group">
                            <textarea placeholder="Your Message" rows="5" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Send Message</button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">Kevin<span>Matoka</span></div>
                <p class="footer-tagline">Clinical Leader & Healthcare Technologist</p>
                <div class="footer-social">
                    <a href="#" title="LinkedIn" id="social-linkedin"><i class="fab fa-linkedin"></i></a>
                    <a href="#" title="GitHub" id="social-github"><i class="fab fa-github"></i></a>
                    <a href="#" title="Twitter" id="social-twitter"><i class="fab fa-twitter"></i></a>
                </div>
                <p class="footer-copyright">
                    &copy; <span id="currentYear"></span> Kevin Matoka Tiong'i. All rights reserved.
                </p>
                <p class="footer-note">
                    Built with HTML, CSS & JavaScript by Kevin Matoka
                </p>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    
    <!-- Supabase Integration Script -->
    <script>
        // Supabase Configuration with YOUR credentials
        const SUPABASE_URL = 'https://uhqoihahmocwjgzpiivd.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVocW9paGFobW9jd2pnenBpaXZkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU2OTUyMTQsImV4cCI6MjA4MTI3MTIxNH0.6HEb9Vy9xR3CFJBRRXPULAQa50wtMgRkPufrh_mGhSY';
        
        // Initialize Supabase client
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Main function to load all data
        async function loadPortfolioData() {
            try {
                console.log('Loading portfolio data from Supabase...');
                
                // 1. Load portfolio content (text fields)
                await loadPortfolioContent();
                
                // 2. Load skills
                await loadSkills();
                
                // 3. Load projects
                await loadProjects();
                
                // 4. Load career timeline
                await loadCareer();
                
                // 5. Apply custom styles
                await applyCustomStyles();
                
                console.log('✅ All data loaded successfully!');
                
            } catch (error) {
                console.error('❌ Error loading portfolio data:', error);
                showErrorMessage();
            }
        }
        
        async function loadPortfolioContent() {
            try {
                const { data, error } = await supabase
                    .from('portfolio_content')
                    .select('*');
                    
                if (error) throw error;
                
                if (data && data.length > 0) {
                    // Convert array to object for easy access
                    const content = {};
                    data.forEach(item => {
                        if (!content[item.section]) {
                            content[item.section] = {};
                        }
                        content[item.section][item.field] = item.content;
                    });
                    
                    // Update Home Section
                    updateHomeSection(content.home || {});
                    
                    // Update About Section
                    updateAboutSection(content.about || {});
                    
                    // Update Contact Section
                    updateContactSection(content.contact || {});
                }
                
            } catch (error) {
                console.error('Error loading portfolio content:', error);
            }
        }
        
        function updateHomeSection(homeData) {
            // Hero Title
            if (homeData.hero_title) {
                document.querySelector('.hero-title').textContent = homeData.hero_title;
            }
            
            // Hero Subtitle
            if (homeData.hero_subtitle) {
                document.querySelector('.hero-subtitle').textContent = homeData.hero_subtitle;
            }
            
            // Hero Description
            if (homeData.hero_description) {
                document.querySelector('.hero-description').textContent = homeData.hero_description;
            }
            
            // Profile Photo
            if (homeData.profile_photo && homeData.profile_photo.trim() !== '') {
                const heroImage = document.querySelector('.hero-image');
                heroImage.innerHTML = `
                    <div class="profile-photo-container">
                        <img src="${homeData.profile_photo}" 
                             alt="Profile Photo of Kevin Matoka" 
                             class="profile-photo"
                             onerror="this.src='data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 400 400\"><rect width=\"400\" height=\"400\" fill=\"%232a6e7a\"/><text x=\"50%\" y=\"50%\" font-family=\"Arial\" font-size=\"80\" fill=\"white\" text-anchor=\"middle\" dy=\".3em\">KM</text></svg>'">
                    </div>
                `;
            }
        }
        
        function updateAboutSection(aboutData) {
            // About Text 1
            if (aboutData.about1) {
                document.getElementById('about-text-1').textContent = aboutData.about1;
            }
            
            // About Text 2
            if (aboutData.about2) {
                const about2Element = document.getElementById('about-text-2');
                if (aboutData.about2.includes('My unique value:')) {
                    about2Element.innerHTML = `<strong>My unique value:</strong> ${aboutData.about2.replace('My unique value:', '').trim()}`;
                } else {
                    about2Element.innerHTML = `<strong>My unique value:</strong> ${aboutData.about2}`;
                }
            }
            
            // About Text 3
            if (aboutData.about3) {
                document.getElementById('about-text-3').textContent = aboutData.about3;
            }
            
            // Stats
            if (aboutData.stat_years) {
                document.getElementById('stat-years').textContent = aboutData.stat_years + '+';
            }
            if (aboutData.stat_students) {
                document.getElementById('stat-students').textContent = aboutData.stat_students + '+';
            }
            if (aboutData.stat_community) {
                document.getElementById('stat-community').textContent = aboutData.stat_community + '+';
            }
            if (aboutData.stat_satisfaction) {
                document.getElementById('stat-satisfaction').textContent = aboutData.stat_satisfaction + '%';
            }
        }
        
        function updateContactSection(contactData) {
            // Email
            if (contactData.email) {
                const emailElement = document.getElementById('contact-email');
                emailElement.textContent = contactData.email;
                emailElement.href = `mailto:${contactData.email}`;
            }
            
            // Phone
            if (contactData.phone) {
                const phoneElement = document.getElementById('contact-phone');
                phoneElement.textContent = contactData.phone;
                phoneElement.href = `tel:${contactData.phone.replace(/\s/g, '')}`;
            }
            
            // Location
            if (contactData.location) {
                document.getElementById('contact-location').textContent = contactData.location;
            }
            
            // Social Links
            if (contactData.linkedin) {
                const linkedinElement = document.getElementById('social-linkedin');
                linkedinElement.href = contactData.linkedin;
                linkedinElement.title = 'LinkedIn Profile';
            }
            if (contactData.github) {
                const githubElement = document.getElementById('social-github');
                githubElement.href = contactData.github;
                githubElement.title = 'GitHub Profile';
            }
            if (contactData.twitter) {
                const twitterElement = document.getElementById('social-twitter');
                twitterElement.href = contactData.twitter;
                twitterElement.title = 'Twitter Profile';
            }
        }
        
        async function loadSkills() {
            try {
                const { data, error } = await supabase
                    .from('skills')
                    .select('*')
                    .order('display_order', { ascending: true });
                    
                if (error) throw error;
                
                const skillsGrid = document.getElementById('skills-grid');
                
                if (data && data.length > 0) {
                    // Group skills by category
                    const skillsByCategory = {};
                    data.forEach(skill => {
                        if (!skillsByCategory[skill.category]) {
                            skillsByCategory[skill.category] = [];
                        }
                        skillsByCategory[skill.category].push(skill);
                    });
                    
                    // Clear loading message
                    skillsGrid.innerHTML = '';
                    
                    // Create skill categories
                    Object.entries(skillsByCategory).forEach(([category, skills]) => {
                        const categoryDiv = document.createElement('div');
                        categoryDiv.className = 'skill-category';
                        
                        // Determine icon based on category
                        let iconClass = 'fas fa-star';
                        if (category.includes('Clinical')) iconClass = 'fas fa-heartbeat';
                        else if (category.includes('Technology')) iconClass = 'fas fa-laptop-code';
                        else if (category.includes('Education')) iconClass = 'fas fa-chalkboard-teacher';
                        else if (category.includes('Public Health')) iconClass = 'fas fa-users';
                        
                        let skillsHTML = '';
                        skills.forEach(skill => {
                            skillsHTML += `<li>${skill.skill_name} <span class="skill-level">(${skill.skill_level})</span></li>`;
                        });
                        
                        categoryDiv.innerHTML = `
                            <h3><i class="${iconClass}"></i> ${category}</h3>
                            <ul class="skill-list">
                                ${skillsHTML}
                            </ul>
                        `;
                        
                        skillsGrid.appendChild(categoryDiv);
                    });
                } else {
                    skillsGrid.innerHTML = '<p class="no-data">No skills data available.</p>';
                }
                
            } catch (error) {
                console.error('Error loading skills:', error);
                document.getElementById('skills-grid').innerHTML = '<p class="error">Failed to load skills.</p>';
            }
        }
        
        async function loadProjects() {
            try {
                const { data, error } = await supabase
                    .from('projects')
                    .select('*')
                    .order('display_order', { ascending: true });
                    
                if (error) throw error;
                
                const projectsGrid = document.getElementById('projects-grid');
                
                if (data && data.length > 0) {
                    // Clear loading message
                    projectsGrid.innerHTML = '';
                    
                    // Create project cards
                    data.forEach(project => {
                        const projectCard = document.createElement('div');
                        projectCard.className = 'project-card';
                        
                        // Parse tags (if stored as array)
                        let tagsHTML = '';
                        if (project.tags && Array.isArray(project.tags) && project.tags.length > 0) {
                            tagsHTML = project.tags.map(tag => 
                                `<span class="tag">${tag}</span>`
                            ).join('');
                        } else if (typeof project.tags === 'string' && project.tags.trim() !== '') {
                            tagsHTML = `<span class="tag">${project.tags}</span>`;
                        }
                        
                        // Parse outcomes
                        let outcomesHTML = '';
                        if (project.outcomes && Array.isArray(project.outcomes) && project.outcomes.length > 0) {
                            outcomesHTML = `
                                <div class="project-outcome">
                                    <h4>Key Outcomes:</h4>
                                    <ul>
                                        ${project.outcomes.map(outcome => `<li>${outcome}</li>`).join('')}
                                    </ul>
                                </div>
                            `;
                        } else if (typeof project.outcomes === 'string' && project.outcomes.trim() !== '') {
                            outcomesHTML = `
                                <div class="project-outcome">
                                    <h4>Key Outcomes:</h4>
                                    <p>${project.outcomes}</p>
                                </div>
                            `;
                        }
                        
                        projectCard.innerHTML = `
                            <div class="project-icon">
                                <i class="${project.icon || 'fas fa-project-diagram'}"></i>
                            </div>
                            <h3>${project.title || 'Project Title'}</h3>
                            ${project.role ? `<p class="project-role">${project.role}</p>` : ''}
                            <p class="project-desc">${project.description || 'Project description goes here.'}</p>
                            ${outcomesHTML}
                            ${tagsHTML ? `<div class="project-tags">${tagsHTML}</div>` : ''}
                        `;
                        
                        projectsGrid.appendChild(projectCard);
                    });
                } else {
                    projectsGrid.innerHTML = '<p class="no-data">No projects data available.</p>';
                }
                
            } catch (error) {
                console.error('Error loading projects:', error);
                document.getElementById('projects-grid').innerHTML = '<p class="error">Failed to load projects.</p>';
            }
        }
        
        async function loadCareer() {
            try {
                const { data, error } = await supabase
                    .from('career')
                    .select('*')
                    .order('display_order', { ascending: true });
                    
                if (error) throw error;
                
                const careerTimeline = document.getElementById('career-timeline');
                
                if (data && data.length > 0) {
                    // Clear loading message
                    careerTimeline.innerHTML = '';
                    
                    // Create career timeline items
                    data.forEach(item => {
                        const timelineItem = document.createElement('div');
                        timelineItem.className = 'timeline-item';
                        
                        let dateText = '';
                        if (item.start_date && item.end_date) {
                            dateText = `${item.start_date} - ${item.end_date}`;
                        } else if (item.start_date) {
                            dateText = `${item.start_date}${item.current ? ' - Present' : ''}`;
                        } else if (item.end_date) {
                            dateText = `${item.end_date}`;
                        }
                        
                        timelineItem.innerHTML = `
                            <div class="timeline-date">${dateText}</div>
                            <div class="timeline-content">
                                <h3>${item.position || 'Position'}</h3>
                                <p class="timeline-org">${item.organization || 'Organization'}</p>
                                <p>${item.description || 'Description of role and responsibilities.'}</p>
                            </div>
                        `;
                        
                        careerTimeline.appendChild(timelineItem);
                    });
                } else {
                    careerTimeline.innerHTML = '<p class="no-data">No career data available.</p>';
                }
                
            } catch (error) {
                console.error('Error loading career:', error);
                document.getElementById('career-timeline').innerHTML = '<p class="error">Failed to load career timeline.</p>';
            }
        }
        
        async function applyCustomStyles() {
            try {
                // Load settings
                const { data, error } = await supabase
                    .from('portfolio_content')
                    .select('*')
                    .eq('section', 'settings');
                    
                if (error) throw error;
                
                if (data && data.length > 0) {
                    const settings = {};
                    data.forEach(item => {
                        settings[item.field] = item.content;
                    });
                    
                    const root = document.documentElement;
                    
                    // Apply primary color
                    if (settings.primary_color) {
                        root.style.setProperty('--primary', settings.primary_color);
                    }
                    
                    // Apply secondary color
                    if (settings.secondary_color) {
                        root.style.setProperty('--secondary', settings.secondary_color);
                    }
                    
                    // Apply font family
                    if (settings.font_family) {
                        document.body.style.fontFamily = `${settings.font_family}, sans-serif`;
                    }
                    
                    // Apply custom CSS
                    if (settings.custom_css && settings.custom_css.trim() !== '') {
                        const style = document.createElement('style');
                        style.textContent = settings.custom_css;
                        document.head.appendChild(style);
                    }
                }
                
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }
        
        function showErrorMessage() {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'data-error';
            errorDiv.style.cssText = `
                background: #f8d7da;
                color: #721c24;
                padding: 10px;
                border: 1px solid #f5c6cb;
                border-radius: 4px;
                margin: 10px;
                text-align: center;
            `;
            errorDiv.innerHTML = `
                <p><i class="fas fa-exclamation-triangle"></i> Unable to load portfolio data.</p>
                <small>Showing default content. Please check your internet connection.</small>
            `;
            document.body.insertBefore(errorDiv, document.body.firstChild);
        }
        
        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Set current year in footer
            document.getElementById('currentYear').textContent = new Date().getFullYear();
            
            // Load data from Supabase
            loadPortfolioData();
        });
    </script>
</body>
    </html>
