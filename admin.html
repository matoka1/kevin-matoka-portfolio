<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Portfolio Editor</title>
    <link rel="stylesheet" href="admin-style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="login-box">
            <h2><i class="fas fa-lock"></i> Portfolio Admin</h2>
            <div class="login-form">
                <input type="password" id="adminPassword" placeholder="Enter Admin Password" autocomplete="off">
                <button id="loginBtn" class="btn-login">Login</button>
                <p class="hint">Default password: admin123</p>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="dashboard" class="dashboard-container" style="display: none;">
        <!-- Header -->
        <header class="admin-header">
            <div class="header-left">
                <h1><i class="fas fa-cogs"></i> Portfolio Admin</h1>
                <p>Edit your portfolio content visually</p>
            </div>
            <div class="header-right">
                <button id="previewBtn" class="btn-preview">
                    <i class="fas fa-eye"></i> Preview
                </button>
                <button id="saveBtn" class="btn-save">
                    <i class="fas fa-save"></i> Save Changes
                </button>
                <button id="logoutBtn" class="btn-logout">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="admin-main">
            <!-- Sidebar Navigation -->
            <aside class="admin-sidebar">
                <nav class="sidebar-nav">
                    <a href="#section-home" class="nav-item active">
                        <i class="fas fa-home"></i> Home
                    </a>
                    <a href="#section-about" class="nav-item">
                        <i class="fas fa-user"></i> About
                    </a>
                    <a href="#section-skills" class="nav-item">
                        <i class="fas fa-star"></i> Skills
                    </a>
                    <a href="#section-projects" class="nav-item">
                        <i class="fas fa-project-diagram"></i> Projects
                    </a>
                    <a href="#section-career" class="nav-item">
                        <i class="fas fa-briefcase"></i> Career
                    </a>
                    <a href="#section-contact" class="nav-item">
                        <i class="fas fa-envelope"></i> Contact
                    </a>
                    <a href="#section-settings" class="nav-item">
                        <i class="fas fa-palette"></i> Colors & Style
                    </a>
                </nav>
            </aside>

            <!-- Content Area -->
            <div class="admin-content">
                <!-- HOME Section Editor -->
                <section id="section-home" class="editor-section active">
                    <h2><i class="fas fa-home"></i> Home Section</h2>
                    <div class="editor-grid">
                        <div class="editor-card">
                            <h3>Hero Title</h3>
                            <textarea id="edit-hero-title" class="editor-textarea" rows="2">Kevin Matoka Tiong'i</textarea>
                        </div>
                        <div class="editor-card">
                            <h3>Hero Subtitle</h3>
                            <textarea id="edit-hero-subtitle" class="editor-textarea" rows="2">Nursing Officer | Healthcare Technologist | Educator</textarea>
                        </div>
                        <div class="editor-card">
                            <h3>Hero Description</h3>
                            <textarea id="edit-hero-description" class="editor-textarea" rows="4">Bridging clinical excellence with technical innovation to build safer, more efficient, and data-driven healthcare systems in Kenya and beyond.</textarea>
                        </div>
                        <div class="editor-card">
                            <h3>Profile Photo</h3>
                            <input type="text" id="edit-profile-photo" class="editor-input" placeholder="Photo URL or path">
                            <small>Enter URL or local path (e.g., images/profile.jpg)</small>
                            <div class="image-preview" id="photoPreview"></div>
                        </div>
                    </div>
                </section>

                <!-- ABOUT Section Editor -->
                <section id="section-about" class="editor-section">
                    <h2><i class="fas fa-user"></i> About Section</h2>
                    <div class="editor-grid">
                        <div class="editor-card">
                            <h3>About Text 1</h3>
                            <textarea id="edit-about1" class="editor-textarea" rows="4">I am a detail-oriented and results-driven Nursing Officer with over 2 years of progressive clinical and leadership experience across diverse healthcare settings. Currently serving as Head of Department, School of Nursing at Nakuru College of Health Science and Management.</textarea>
                        </div>
                        <div class="editor-card">
                            <h3>About Text 2</h3>
                            <textarea id="edit-about2" class="editor-textarea" rows="4">My unique value: I combine hands-on clinical expertise with technical skills in software engineering, database management, and cybersecurity. This dual competency allows me to translate clinical workflows into technical requirements, design secure health applications, and implement systems that improve patient care and healthcare delivery.</textarea>
                        </div>
                        <div class="editor-card">
                            <h3>Stats</h3>
                            <div class="stats-grid">
                                <div class="stat-input">
                                    <label>Years Experience:</label>
                                    <input type="number" id="edit-stat1" value="2" min="0">
                                </div>
                                <div class="stat-input">
                                    <label>Students Mentored:</label>
                                    <input type="number" id="edit-stat2" value="500" min="0">
                                </div>
                                <div class="stat-input">
                                    <label>Community Served:</label>
                                    <input type="number" id="edit-stat3" value="1000" min="0">
                                </div>
                                <div class="stat-input">
                                    <label>Satisfaction %:</label>
                                    <input type="number" id="edit-stat4" value="98" min="0" max="100">
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- CONTACT Section Editor -->
                <section id="section-contact" class="editor-section">
                    <h2><i class="fas fa-envelope"></i> Contact Section</h2>
                    <div class="editor-grid">
                        <div class="editor-card">
                            <h3>Email Address</h3>
                            <input type="email" id="edit-contact-email" class="editor-input" value="matokakevin98@gmail.com">
                        </div>
                        <div class="editor-card">
                            <h3>Phone Number</h3>
                            <input type="text" id="edit-contact-phone" class="editor-input" value="+254 790 969 743">
                        </div>
                        <div class="editor-card">
                            <h3>Location</h3>
                            <input type="text" id="edit-contact-location" class="editor-input" value="Nakuru, Kenya">
                        </div>
                        <div class="editor-card">
                            <h3>Social Links</h3>
                            <div class="social-inputs">
                                <div class="social-input">
                                    <label><i class="fab fa-linkedin"></i> LinkedIn:</label>
                                    <input type="text" id="edit-linkedin" class="editor-input" placeholder="LinkedIn profile URL">
                                </div>
                                <div class="social-input">
                                    <label><i class="fab fa-github"></i> GitHub:</label>
                                    <input type="text" id="edit-github" class="editor-input" placeholder="GitHub profile URL">
                                </div>
                                <div class="social-input">
                                    <label><i class="fab fa-twitter"></i> Twitter:</label>
                                    <input type="text" id="edit-twitter" class="editor-input" placeholder="Twitter profile URL">
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- COLORS & STYLE Editor -->
                <section id="section-settings" class="editor-section">
                    <h2><i class="fas fa-palette"></i> Color & Style Settings</h2>
                    <div class="editor-grid">
                        <div class="editor-card">
                            <h3>Primary Color</h3>
                            <input type="color" id="edit-color-primary" value="#2a6e7a">
                            <input type="text" id="edit-color-primary-text" value="#2a6e7a">
                        </div>
                        <div class="editor-card">
                            <h3>Secondary Color</h3>
                            <input type="color" id="edit-color-secondary" value="#e63946">
                            <input type="text" id="edit-color-secondary-text" value="#e63946">
                        </div>
                        <div class="editor-card">
                            <h3>Font Family</h3>
                            <select id="edit-font-family" class="editor-select">
                                <option value="Poppins">Poppins</option>
                                <option value="Roboto">Roboto</option>
                                <option value="Open Sans">Open Sans</option>
                                <option value="Montserrat">Montserrat</option>
                                <option value="Arial">Arial</option>
                            </select>
                        </div>
                        <div class="editor-card">
                            <h3>Custom CSS</h3>
                            <textarea id="edit-custom-css" class="editor-textarea" rows="6" placeholder="Add custom CSS here..."></textarea>
                        </div>
                    </div>
                </section>

                <!-- Live Preview -->
                <section class="preview-section">
                    <h2><i class="fas fa-desktop"></i> Live Preview</h2>
                    <div class="preview-container">
                        <iframe id="livePreview" src="index.html" width="100%" height="500"></iframe>
                    </div>
                </section>
            </div>
        </main>

        <!-- Status Bar -->
        <footer class="admin-footer">
            <div class="status-bar">
                <span id="saveStatus" class="status-saved">
                    <i class="fas fa-check-circle"></i> All changes saved
                </span>
                <span class="last-saved">Last saved: <span id="lastSavedTime">Just now</span></span>
            </div>
        </footer>
    </div>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://uhqoihahmocwjgzpiivd.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVocW9paGFobW9jd2pnenBpaXZkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU2OTUyMTQsImV4cCI6MjA4MTI3MTIxNH0.6HEb9Vy9xR3CFJBRRXPULAQa50wtMgRkPufrh_mGhSY';
        
        // Initialize Supabase
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Simple password protection
        const ADMIN_PASSWORD = 'admin123';
        let isAuthenticated = localStorage.getItem('portfolio_admin_auth') === 'true';
        
        // DOM Elements
        const loginScreen = document.getElementById('loginScreen');
        const dashboard = document.getElementById('dashboard');
        const adminPassword = document.getElementById('adminPassword');
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const saveBtn = document.getElementById('saveBtn');
        const previewBtn = document.getElementById('previewBtn');
        const saveStatus = document.getElementById('saveStatus');
        const lastSavedTime = document.getElementById('lastSavedTime');
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            if (isAuthenticated) {
                showDashboard();
                loadCurrentData();
            } else {
                showLoginScreen();
            }
            
            setupEventListeners();
        });
        
        function showLoginScreen() {
            loginScreen.style.display = 'flex';
            dashboard.style.display = 'none';
        }
        
        function showDashboard() {
            loginScreen.style.display = 'none';
            dashboard.style.display = 'block';
        }
        
        async function loadCurrentData() {
            try {
                // Load current data from Supabase to populate the form
                const { data, error } = await supabase
                    .from('portfolio_content')
                    .select('*');
                    
                if (error) throw error;
                
                if (data && data.length > 0) {
                    // Organize data
                    const content = {};
                    data.forEach(item => {
                        if (!content[item.section]) {
                            content[item.section] = {};
                        }
                        content[item.section][item.field] = item.content;
                    });
                    
                    // Populate form fields
                    populateFormFields(content);
                }
                
            } catch (error) {
                console.error('Error loading current data:', error);
                alert('Failed to load current data. Using default values.');
            }
        }
        
        function populateFormFields(content) {
            // Home section
            if (content.home) {
                if (content.home.hero_title) document.getElementById('edit-hero-title').value = content.home.hero_title;
                if (content.home.hero_subtitle) document.getElementById('edit-hero-subtitle').value = content.home.hero_subtitle;
                if (content.home.hero_description) document.getElementById('edit-hero-description').value = content.home.hero_description;
                if (content.home.profile_photo) {
                    document.getElementById('edit-profile-photo').value = content.home.profile_photo;
                    updatePhotoPreview(content.home.profile_photo);
                }
            }
            
            // About section
            if (content.about) {
                if (content.about.about1) document.getElementById('edit-about1').value = content.about.about1;
                if (content.about.about2) {
                    // Remove "My unique value:" prefix if present
                    const about2 = content.about.about2.replace('My unique value:', '').trim();
                    document.getElementById('edit-about2').value = about2;
                }
                if (content.about.stat_years) document.getElementById('edit-stat1').value = content.about.stat_years;
                if (content.about.stat_students) document.getElementById('edit-stat2').value = content.about.stat_students;
                if (content.about.stat_community) document.getElementById('edit-stat3').value = content.about.stat_community;
                if (content.about.stat_satisfaction) document.getElementById('edit-stat4').value = content.about.stat_satisfaction;
            }
            
            // Contact section
            if (content.contact) {
                if (content.contact.email) document.getElementById('edit-contact-email').value = content.contact.email;
                if (content.contact.phone) document.getElementById('edit-contact-phone').value = content.contact.phone;
                if (content.contact.location) document.getElementById('edit-contact-location').value = content.contact.location;
                if (content.contact.linkedin) document.getElementById('edit-linkedin').value = content.contact.linkedin;
                if (content.contact.github) document.getElementById('edit-github').value = content.contact.github;
                if (content.contact.twitter) document.getElementById('edit-twitter').value = content.contact.twitter;
            }
            
            // Settings section
            if (content.settings) {
                if (content.settings.primary_color) {
                    document.getElementById('edit-color-primary').value = content.settings.primary_color;
                    document.getElementById('edit-color-primary-text').value = content.settings.primary_color;
                }
                if (content.settings.secondary_color) {
                    document.getElementById('edit-color-secondary').value = content.settings.secondary_color;
                    document.getElementById('edit-color-secondary-text').value = content.settings.secondary_color;
                }
                if (content.settings.font_family) {
                    document.getElementById('edit-font-family').value = content.settings.font_family;
                }
                if (content.settings.custom_css) {
                    document.getElementById('edit-custom-css').value = content.settings.custom_css;
                }
            }
        }
        
        function updatePhotoPreview(photoUrl) {
            const preview = document.getElementById('photoPreview');
            if (photoUrl && photoUrl.trim() !== '') {
                preview.innerHTML = `<img src="${photoUrl}" alt="Preview" style="max-width: 100%; max-height: 150px;">`;
            } else {
                preview.innerHTML = '<p>No photo selected</p>';
            }
        }
        
        async function saveAllChanges() {
            try {
                // Collect all data
                const updates = [];
                
                // Home section
                updates.push({
                    section: 'home',
                    field: 'hero_title',
                    content: document.getElementById('edit-hero-title').value
                });
                updates.push({
                    section: 'home',
                    field: 'hero_subtitle',
                    content: document.getElementById('edit-hero-subtitle').value
                });
                updates.push({
                    section: 'home',
                    field: 'hero_description',
                    content: document.getElementById('edit-hero-description').value
                });
                updates.push({
                    section: 'home',
                    field: 'profile_photo',
                    content: document.getElementById('edit-profile-photo').value
                });
                
                // About section
                updates.push({
                    section: 'about',
                    field: 'about1',
                    content: document.getElementById('edit-about1').value
                });
                updates.push({
                    section: 'about',
                    field: 'about2',
                    content: 'My unique value: ' + document.getElementById('edit-about2').value
                });
                updates.push({
                    section: 'about',
                    field: 'stat_years',
                    content: document.getElementById('edit-stat1').value
                });
                updates.push({
                    section: 'about',
                    field: 'stat_students',
                    content: document.getElementById('edit-stat2').value
                });
                updates.push({
                    section: 'about',
                    field: 'stat_community',
                    content: document.getElementById('edit-stat3').value
                });
                updates.push({
                    section: 'about',
                    field: 'stat_satisfaction',
                    content: document.getElementById('edit-stat4').value
                });
                
                // Contact section
                updates.push({
                    section: 'contact',
                    field: 'email',
                    content: document.getElementById('edit-contact-email').value
                });
                updates.push({
                    section: 'contact',
                    field: 'phone',
                    content: document.getElementById('edit-contact-phone').value
                });
                updates.push({
                    section: 'contact',
                    field: 'location',
                    content: document.getElementById('edit-contact-location').value
                });
                updates.push({
                    section: 'contact',
                    field: 'linkedin',
                    content: document.getElementById('edit-linkedin').value
                });
                updates.push({
                    section: 'contact',
                    field: 'github',
                    content: document.getElementById('edit-github').value
                });
                updates.push({
                    section: 'contact',
                    field: 'twitter',
                    content: document.getElementById('edit-twitter').value
                });
                
                // Settings section
                updates.push({
                    section: 'settings',
                    field: 'primary_color',
                    content: document.getElementById('edit-color-primary').value
                });
                updates.push({
                    section: 'settings',
                    field: 'secondary_color',
                    content: document.getElementById('edit-color-secondary').value
                });
                updates.push({
                    section: 'settings',
                    field: 'font_family',
                    content: document.getElementById('edit-font-family').value
                });
                updates.push({
                    section: 'settings',
                    field: 'custom_css',
                    content: document.getElementById('edit-custom-css').value
                });
                
                // Save to Supabase
                const { error } = await supabase
                    .from('portfolio_content')
                    .upsert(updates, {
                        onConflict: 'section,field'
                    });
                
                if (error) throw error;
                
                // Update status
                updateSaveStatus(true);
                
                // Refresh preview
                document.getElementById('livePreview').contentWindow.location.reload();
                
                return true;
                
            } catch (error) {
                console.error('Error saving changes:', error);
                updateSaveStatus(false, error.message);
                return false;
            }
        }
        
        function updateSaveStatus(success, message = '') {
            const now = new Date();
            lastSavedTime.textContent = now.toLocaleTimeString();
            
            if (success) {
                saveStatus.className = 'status-saved';
                saveStatus.innerHTML = '<i class="fas fa-check-circle"></i> Saved to Supabase';
            } else {
                saveStatus.className = 'status-error';
                saveStatus.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${message || 'Save Failed'}`;
            }
            
            // Reset status after 5 seconds
            setTimeout(() => {
                saveStatus.className = 'status-saved';
                saveStatus.innerHTML = '<i class="fas fa-check-circle"></i> All changes saved';
            }, 5000);
        }
        
        function setupEventListeners() {
            // Login
            loginBtn.addEventListener('click', function() {
                const password = adminPassword.value.trim();
                if (password === ADMIN_PASSWORD) {
                    localStorage.setItem('portfolio_admin_auth', 'true');
                    isAuthenticated = true;
                    showDashboard();
                    loadCurrentData();
                } else {
                    alert('Incorrect password. Try again.');
                }
            });
            
            // Logout
            logoutBtn.addEventListener('click', function() {
                localStorage.removeItem('portfolio_admin_auth');
                isAuthenticated = false;
                showLoginScreen();
            });
            
            // Save button
            saveBtn.addEventListener('click', saveAllChanges);
            
            // Preview button
            previewBtn.addEventListener('click', function() {
                window.open('index.html', '_blank');
            });
            
            // Photo preview
            document.getElementById('edit-profile-photo').addEventListener('input', function() {
                updatePhotoPreview(this.value);
            });
            
            // Color inputs sync
            document.getElementById('edit-color-primary').addEventListener('input', function() {
                document.getElementById('edit-color-primary-text').value = this.value;
            });
            document.getElementById('edit-color-primary-text').addEventListener('input', function() {
                document.getElementById('edit-color-primary').value = this.value;
            });
            document.getElementById('edit-color-secondary').addEventListener('input', function() {
                document.getElementById('edit-color-secondary-text').value = this.value;
            });
            document.getElementById('edit-color-secondary-text').addEventListener('input', function() {
                document.getElementById('edit-color-secondary').value = this.value;
            });
            
            // Navigation
            const navItems = document.querySelectorAll('.nav-item');
            const sections = document.querySelectorAll('.editor-section');
            
            navItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Update active nav
                    navItems.forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show section
                    const targetId = this.getAttribute('href');
                    sections.forEach(section => {
                        section.classList.remove('active');
                        if (section.id === targetId.substring(1)) {
                            section.classList.add('active');
                        }
                    });
                });
            });
            
            // Auto-save indicator on changes
            const inputs = document.querySelectorAll('textarea, input, select');
            inputs.forEach(input => {
                input.addEventListener('input', function() {
                    saveStatus.className = 'status-unsaved';
                    saveStatus.innerHTML = '<i class="fas fa-pencil-alt"></i> Unsaved changes';
                });
            });
            
            // Enter key to login
            adminPassword.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    loginBtn.click();
                }
            });
        }
    </script>
</body>
    </html>
